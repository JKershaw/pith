# Benchmark Run: 2026-01-01 (Self-Test)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 43 files extracted, ~20k lines (source only)
- **Pith version**: b94ab85
- **Model**: qwen/qwen-turbo
- **Tasks**: 15 (3 per category, full task bank)

## Pipeline Metrics

| Stage      | Time                   | Notes                                               |
| ---------- | ---------------------- | --------------------------------------------------- |
| Extraction | 16.4s (13.1s internal) | 43 files extracted                                  |
| Build      | 6.2s (2.9s internal)   | 152 nodes created (43 file, 99 function, 10 module) |
| Generation | 234.0s (~3.9 min)      | 53 nodes with prose (files + modules)               |
| **Total**  | ~257s (~4.3 min)       | Full pipeline with prose                            |

- Nodes created: 43 file, 99 function, 10 module (152 total)
- Nodes with prose: 53 (files + modules)
- Estimated cost: ~$0.50-1.00 (qwen-turbo)

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components

**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **20/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~8,000 (bundled context) | **Control tokens**: ~2,125
**Notes**: Pith provides module summaries with purpose, data flow, and gotchas. Control found 7 core modules with detailed line references and interaction diagram. Pith's prose is well-structured but more verbose.

---

#### A2: Data Flow

**Question**: "Explain the data flow from file input to wiki output."

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **20/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~8,000 | **Control tokens**: ~1,800
**Notes**: Pith's "Data Flow" sections in module prose describe transformations. Control traced complete 4-stage pipeline with specific function calls and line numbers (e.g., extractFile:464, buildPrompt:83-91).

---

#### A3: Design Patterns

**Question**: "What design patterns are used in this codebase?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~8,000 | **Control tokens**: ~2,200
**Notes**: Pith mentions some patterns in prose (e.g., "Node-based graph representation"). Control identified 8 architectural patterns (Factory, Builder, Strategy, Singleton, Repository, Template Method, Observer/Batch, Graph) with file:line references.

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache

**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 5/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 4/5       | 5/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **22/25** | **25/25** |

**Winner**: Control
**Pith tokens**: ~1,500 (cache.ts node) | **Control tokens**: ~300
**Notes**: Both correctly identified SHA-256 hashing. Pith shows function signatures and edges. Control explained the complete logic with specific line references (shouldExtract:85-100, getFileHash:26-30).

---

#### B2: buildPrompt Function

**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~4,000 (generator module) | **Control tokens**: ~2,125
**Notes**: Pith shows buildPrompt exists with high-level description. Control documented full dispatch logic (lines 83-91), file vs module prompts (lines 131-276 vs 284-352), and helper functions.

---

#### B3: LLM Retry Logic

**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 5/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **20/25** | **25/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~800
**Notes**: Pith mentions "LLM integration" in prose. Control found specific: maxRetries=3, timeout=30s, backoff=2^attempt\*1000ms, isRetryableError() at lines 703-724 with all retryable conditions (429, 5xx, AbortError, network errors).

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact

**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 5/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 5/5       | 3/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **23/25** | **23/25** |

**Winner**: Tie
**Pith tokens**: ~200 (edges only) | **Control tokens**: ~5,000
**Notes**: Pith's importedBy edges immediately showed 8 dependent files. Control found same 8 files plus test files with specific line numbers. Pith more efficient (25x fewer tokens); Control more complete.

---

#### R2: API to Database

**Question**: "How do the API routes connect to the database layer?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **19/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~3,500
**Notes**: Pith prose shows "Data enters via index.ts". Control traced complete flow: getDb() singleton → createApp(db) → db.collection<WikiNode>('nodes') with 5 route mappings and line numbers.

---

#### R3: extractFile Consumers

**Question**: "What are all the consumers of the extractFile function?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 2/5       | 5/5       |
| Accuracy      | 4/5       | 5/5       |
| Efficiency    | 4/5       | 4/5       |
| Actionability | 2/5       | 5/5       |
| **Total**     | **15/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~200 (edges) | **Control tokens**: ~2,000
**Notes**: Pith shows file-level importedBy (2 files). Control found 1 production consumer (cli:185) and 32+ test consumers with specific line numbers. **Critical gap**: Pith lacks function-level consumer tracking.

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose

**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~1,050
**Notes**: Pith includes "Debugging" section with general patterns. Control identified specific: parseLLMResponse validation gap (line 383-387 checks type but not content), empty string acceptance, no validation before DB storage.

---

#### D2: Slow Generation

**Question**: "Why might the generate command be slow?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **16/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~1,275
**Notes**: Control identified sequential bottleneck (vs extract's BATCH_SIZE=4), 30s timeout per request, 3 retries with exponential backoff. Pith mentions "LLM integration" without performance details.

---

#### D3: 404 for Existing File

**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **18/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~1,200
**Notes**: Pith fuzzy.ts prose shows confidence thresholds. Control found 6 specific causes: path format mismatch, case sensitivity, fuzzy confidence <0.4, node not extracted, ID format inconsistency, with code evidence.

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support

**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 2/5       | 5/5       |
| Completeness  | 2/5       | 5/5       |
| Accuracy      | 4/5       | 5/5       |
| Efficiency    | 2/5       | 5/5       |
| Actionability | 2/5       | 5/5       |
| **Total**     | **12/25** | **25/25** |

**Winner**: Control
**Pith tokens**: ~8,000 | **Control tokens**: ~212
**Notes**: Pith mentions "TypeScript extraction" generally. Control identified 6 hardcoded locations: ast.ts:365,380 (patterns), builder/index.ts:614 (test detection), cross-file-calls.ts:88 (import resolution), config/index.ts:45,48.

---

#### M2: Rate Limiting

**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 5/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **18/25** | **25/25** |

**Winner**: Control
**Pith tokens**: ~4,000 | **Control tokens**: ~187
**Notes**: Pith shows API structure and Quick Start. Control found: only middleware is express.json() (line 883), 5 routes to protect (lines 888, 970, 1015, 1089, 1138), insertion point for rate limiter middleware.

---

#### M3: Add Complexity Field

**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 4/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **19/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~200 (edges) | **Control tokens**: ~275
**Notes**: Pith importedBy shows 8 consuming files. Control provided: WikiNode interface (builder/index.ts:116-152), 3 builder functions (lines 159, 282, 357), API/generator/CLI consumption points, test fixtures needed.

---

## Summary

### Overall Scores

| Metric            | Pith                | Control             |
| ----------------- | ------------------- | ------------------- |
| **Average score** | **18.2/25 (72.8%)** | **24.1/25 (96.4%)** |
| Win/Loss/Tie      | 0-14-1              | 14-0-1              |

### Score Breakdown by Category

| Category             | Pith Avg | Control Avg | Gap  |
| -------------------- | -------- | ----------- | ---- |
| Architecture (A1-A3) | 19.0     | 24.0        | -5.0 |
| Behavior (B1-B3)     | 19.7     | 24.7        | -5.0 |
| Relationship (R1-R3) | 19.0     | 23.7        | -4.7 |
| Debugging (D1-D3)    | 17.0     | 24.0        | -7.0 |
| Modification (M1-M3) | 16.3     | 24.7        | -8.4 |

### Score Breakdown by Criterion

| Criterion     | Pith Avg | Control Avg | Gap  |
| ------------- | -------- | ----------- | ---- |
| Relevance     | 3.7      | 5.0         | -1.3 |
| Completeness  | 3.3      | 5.0         | -1.7 |
| Accuracy      | 4.9      | 5.0         | -0.1 |
| Efficiency    | 3.3      | 4.3         | -1.0 |
| Actionability | 3.3      | 5.0         | -1.7 |

### Token Usage Comparison

| Metric              | Pith    | Control | Ratio |
| ------------------- | ------- | ------- | ----- |
| Total tokens (est.) | ~66,000 | ~23,000 | 2.9x  |
| Average per task    | ~4,400  | ~1,530  | 2.9x  |
| Most efficient task | 200     | 187     | R1/M2 |
| Least efficient     | 8,000   | 5,000   | A1/R1 |

### Comparison to Previous Benchmarks

| Metric          | v4 (2025-12-31) | v7 (2025-12-30) | This Run (2026-01-01) | Change from v4 |
| --------------- | --------------- | --------------- | --------------------- | -------------- |
| Pith Average    | 17.8/25 (71%)   | 16.3/25 (65%)   | 18.2/25 (73%)         | **+2%**        |
| Control Average | 24.0/25 (96%)   | 23.9/25 (96%)   | 24.1/25 (96%)         | 0%             |
| Gap             | -6.2 points     | -7.6 points     | -5.9 points           | **+0.3**       |
| Pith Win Rate   | 0-14-1          | 0-15-0          | 0-14-1                | Same           |

---

## Information Gap Analysis

### Critical Issues Identified

| Issue                          | Impact | Examples                                                   |
| ------------------------------ | ------ | ---------------------------------------------------------- |
| **Missing specific line refs** | High   | B2, D1, D2: Returns descriptions without precise locations |
| **No implementation guidance** | High   | M1, M2: Shows structure but not modification steps         |
| **File-level vs symbol-level** | High   | R3: importedBy shows 2 files, not 32+ function call sites  |
| **Token inefficiency**         | Medium | 2.9x more tokens than Control on average                   |

### Information Type Comparison

| Information Type       |  Pith   | Control | Gap Severity |
| ---------------------- | :-----: | :-----: | :----------: |
| Module/file names      |   ✅    |   ✅    |     None     |
| One-line summary       |   ✅    | Partial |     None     |
| Purpose description    |   ✅    | Partial |     None     |
| Gotchas/warnings       |   ✅    |   ❌    |    Minor     |
| Quick Start examples   |   ✅    |   ❌    |    Minor     |
| Import relationships   |   ✅    |   ✅    |     None     |
| Fan-in/fan-out metrics |   ✅    |   ❌    |    Minor     |
| Line numbers           | Partial |   ✅    |    Medium    |
| Code snippets          | Partial |   ✅    |     High     |
| Function signatures    |   ✅    |   ✅    |     None     |
| Implementation details |   ❌    |   ✅    |   Critical   |
| Cross-file flows       |   ❌    |   ✅    |     High     |
| Symbol-level tracking  |   ❌    |   ✅    |     High     |
| Modification planning  |   ❌    |   ✅    |   Critical   |

---

## Key Conclusions

### 1. Improvement from Previous Runs

- **Pith score improved**: 71% (v4) → **73%** (+2%)
- **Gap narrowed**: 6.2 → **5.9 points**
- **One tie achieved**: R1 (WikiNode Impact) scored equally

### 2. Pith Strengths

- **Accuracy**: 4.9/5 average - information provided is correct
- **Pre-computed dependencies**: importedBy edges provide instant file impact analysis (R1 tie)
- **Structured prose**: Purpose, Data Flow, Gotchas, Quick Start sections
- **Module summaries**: High-level architectural understanding
- **Retrieval speed**: Sub-second vs Control's multi-minute exploration

### 3. Persistent Weaknesses

- **Modification tasks worst**: 16.3/25 average (-8.4 gap to Control)
- **Debugging tasks weak**: 17.0/25 average (-7.0 gap)
- **Token inefficiency**: 2.9x more tokens than Control
- **Missing implementation guidance**: Cannot provide step-by-step modification plans
- **Symbol-level tracking**: Cannot identify function-level consumers

### 4. Control's Consistent Strengths

- Near-perfect scores across all criteria (96.4%)
- Targeted searches with specific line references
- Symbol-level precision
- Implementation-ready guidance

---

## Recommendations

### For Pith Development (Priority Order)

1. **High - Symbol tracking**: Track function/type consumers, not just file imports (R3 gap)
2. **High - Line number precision**: Include more contextual line references in prose
3. **High - Implementation guidance**: Add "How to modify" sections for key interfaces
4. **Medium - Token efficiency**: More targeted context retrieval for queries
5. **Medium - Debugging enhancements**: Specific root cause analysis in prose

### For Usage

1. **Use Pith for**: Quick orientation, architecture overview, finding gotchas, dependency impact (R1)
2. **Use Control for**: Implementation planning, debugging, modification tasks
3. **Combined approach**: Start with Pith for context, then use Control for details

---

## Revision History

| Date       | Change                | Author |
| ---------- | --------------------- | ------ |
| 2026-01-01 | Initial benchmark run | Claude |
