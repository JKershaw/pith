# Benchmark Run: 2025-12-30 (v7 - Comprehensive 15 Tasks)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 38 files extracted, ~5.7k lines (source only)
- **Pith version**: 46c0adf
- **Model**: N/A (generation skipped - no API key)
- **Tasks**: 15 (3 per category, full task bank)

## Pipeline Metrics

| Stage | Time | Notes |
|-------|------|-------|
| Extraction | 10.2s | 38 files extracted |
| Build | 3.1s | 132 nodes created (38 file, 84 function, 10 module) |
| Generation | Skipped | No OPENROUTER_API_KEY configured |
| **Total** | ~13s | Pipeline runs but no prose generated |

- Nodes created: 38 file, 84 function, 10 module (132 total)
- Nodes with prose: 0 (generation skipped)
- Estimated cost: $0 (no LLM calls made)

**Note**: This benchmark evaluates Pith's extracted raw data (without LLM-generated prose) against Control agent exploration. This represents a worst-case scenario for Pith since prose generation is a core value proposition.

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components
**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith provided module list (src/api, src/builder, etc.) with edges. Control identified 8 components with detailed data flow, line numbers, and architectural patterns.

---

#### A2: Data Flow
**Question**: "Explain the data flow from file input to wiki output."

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **14/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows module→file edges but no data flow explanation (requires prose). Control traced 4 phases with specific functions: Extract (ast.ts:348-572), Build (builder:117-341), Generate (generator:80-88→620-716), Serve (api:481-692).

---

#### A3: Design Patterns
**Question**: "What design patterns are used in this codebase?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith's raw data has no pattern information (patterns are in extracted.json, not surfaced). Control identified 24 patterns: Singleton (db:13-29), Factory (builder:117,235,310), Command (cli:44-476), Strategy (generator:80-88), etc.

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache
**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **15/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows cache.ts exists with function signatures. Control explained: SHA-256 hash (cache.ts:26-30), shouldExtract logic (85-100), CLI integration (cli:144-164,220-225).

---

#### B2: buildPrompt Function
**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows buildPrompt in function list. Control documented full dispatch (80-88), file prompts (128-267) with 6 sections, module prompts (275-340), and helper functions formatFunctionForPrompt (112-121), formatKeyStatements (95-105).

---

#### B3: LLM Retry Logic
**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows generator functions exist. Control found: maxRetries=3 (626), timeout=30000ms (627), exponential backoff 2^attempt (679,705), retryable errors at isRetryableError (593-612), AbortController timeout (645-646).

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact
**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **23/25** |

**Winner**: Control
**Notes**: Pith could show import edges pointing to builder/index.ts. Control mapped 10 importing files with specific line numbers: cli:33, api:2, generator:1, cross-file-calls:6, plus 5 test files. Documented 62+ specific property access locations.

---

#### R2: API to Database
**Question**: "How do the API routes connect to the database layer?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows separate api and db modules. Control traced full flow: getDb() singleton (db:13-29), createApp(db) (api:481), route handlers with db.collection at api:499,583, collection queries with findOne/find patterns.

---

#### R3: extractFile Consumers
**Question**: "What are all the consumers of the extractFile function?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows extractFile exists at ast.ts. Control found: definition at ast.ts:348, 1 production consumer (cli:181), 42 test consumers across 3 test files with specific line numbers.

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose
**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith has no debugging information (requires prose). Control identified 6 root causes: JSON parsing (346-360), missing validation for empty strings (371-376), module child summary propagation (854-858), and provided 6-step debug guide.

---

#### D2: Slow Generation
**Question**: "Why might the generate command be slow?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith provides no performance insights. Control identified 8 bottlenecks: sequential processing (cli:588-628), 30s timeout (627), exponential backoff (679,705), sequential DB updates (614), module child queries (602-604), cross-file call graph O(n²) loops.

---

#### D3: 404 for Existing File
**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows api module exists. Control found 4 causes: Windows path separators (ast:265 vs api:496), import path resolution (builder:411-460), missing path normalization (contrast with cross-file-calls:85), module node lookup failures.

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support
**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows TypeScript extraction. Control identified 7 locations: config patterns (45,48), ast.ts extension check (264), ts-morph allowJs (333-339), isTestFile (561-573), buildTestFileEdges (600-645), CLI description (87). Provided complete implementation plan.

---

#### M2: Rate Limiting
**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 1/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 3/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **11/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows api module. Control provided implementation: middleware insertion point (api:488), 4 routes with protection levels, express-rate-limit code examples, per-endpoint limits based on computational cost.

---

#### M3: Add Complexity Field
**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **23/25** |

**Winner**: Control
**Notes**: Pith shows WikiNode definition location. Control mapped 10 files: interface (builder:76-110), 3 creation functions (117-204, 235-274, 310-341), computeMetadata (536-553), generator (128-200), api (113-200), plus 3 test files.

---

## Summary

### Overall Scores

| Metric | Pith (Raw Data) | Control |
|--------|-----------------|---------|
| **Average score** | **12.9/25 (51.6%)** | **23.9/25 (95.6%)** |
| Win/Loss/Tie | 0-15-0 | 15-0-0 |

### Score Breakdown by Category

| Category | Pith Avg | Control Avg | Gap |
|----------|----------|-------------|-----|
| Architecture (A1-A3) | 13.7 | 24.0 | -10.3 |
| Behavior (B1-B3) | 13.7 | 24.0 | -10.3 |
| Relationship (R1-R3) | 15.0 | 23.7 | -8.7 |
| Debugging (D1-D3) | 11.0 | 24.0 | **-13.0** |
| Modification (M1-M3) | 11.7 | 23.7 | **-12.0** |

### Score Breakdown by Criterion

| Criterion | Pith Avg | Control Avg | Gap |
|-----------|----------|-------------|-----|
| Relevance | 1.9 | 5.0 | **-3.1** |
| Completeness | 1.3 | 5.0 | **-3.7** |
| Accuracy | 3.6 | 5.0 | -1.4 |
| Efficiency | 5.0 | 3.9 | **+1.1** |
| Actionability | 1.2 | 5.0 | **-3.8** |

### Comparison to Previous Runs

| Metric | v6 (15 tasks, with prose) | v7 (15 tasks, no prose) |
|--------|---------------------------|-------------------------|
| Pith Average | 15.7/25 (63%) | **12.9/25 (52%)** |
| Control Average | 23.9/25 (96%) | **23.9/25 (96%)** |
| Pith Win Rate | 0% | **0%** |
| Gap | -8.2 points | **-11.0 points** |

**Key Finding**: Without LLM-generated prose, Pith scores 11% lower (52% vs 63%). This confirms that prose generation is a critical component of Pith's value proposition.

---

## Information Gap Analysis

### Pith Advantages (Raw Data Only)

| Information Type | Pith | Control | Notes |
|------------------|------|---------|-------|
| Conciseness | 5.0/5 | 3.9/5 | Raw data is minimal |
| Token efficiency | ~500 tokens | ~13k tokens | 26x smaller |
| Retrieval speed | <10ms | 30-60s | Pre-indexed |
| Module structure | ✅ | ✅ | Both identify |
| Function signatures | ✅ | ✅ | Both extract |
| Edge relationships | ✅ | ⚠️ | Pith has graph, Control must infer |

### Control Advantages

| Information Type | Pith | Control | Gap Severity |
|------------------|------|---------|--------------|
| Design pattern identification | ❌ | ✅ 24 patterns | **Critical** |
| Line number references | ⚠️ Listed | ✅ Contextual | High |
| Cross-file tracing | ⚠️ Edges only | ✅ Complete | **Critical** |
| Root cause analysis | ❌ | ✅ 6-8 causes | **Critical** |
| Implementation guides | ❌ | ✅ Step-by-step | **Critical** |
| Consumer mapping | ⚠️ Edge count | ✅ All refs | **Critical** |
| Debugging guidance | ❌ | ✅ Debug steps | **Critical** |
| Modification planning | ❌ | ✅ Change list | **Critical** |

---

## Key Conclusions

### 1. Prose Generation is Essential
Without LLM-generated prose, Pith's average score drops from 63% to 52%. The prose provides:
- Purpose and gotchas (debugging value)
- Pattern identification (architecture value)
- Data flow explanations (relationship value)

### 2. Raw Extraction Has Limited Standalone Value
The extracted data (imports, exports, functions, edges) provides:
- Structural overview (modules, files, functions)
- Dependency graph (import/contains edges)
- Basic metadata (lines, commits, authors)

But lacks:
- Explanatory context
- Debugging guidance
- Implementation recommendations

### 3. Control Agent Excels at Detailed Analysis
The Control agent consistently provides:
- Specific file:line references
- Multi-step implementation plans
- Root cause analysis
- Code examples

### 4. Pith's Value is in Prepared Context
Pith's advantage is speed and efficiency:
- Sub-second retrieval vs 30-60s exploration
- 26x smaller token footprint
- Pre-computed relationships

But this advantage only materializes with prose generation enabled.

---

## Recommendations

### Immediate Actions
1. **Configure API key**: Set OPENROUTER_API_KEY to enable prose generation
2. **Re-run benchmark**: Compare v7 results with prose-enabled generation
3. **Document API key requirement**: Make it clearer that generation requires configuration

### For Pith Development
1. **Critical**: Prose generation is essential - consider caching/storing generated prose
2. **High**: Add pattern recognition to raw extraction (not just prose)
3. **Medium**: Include more actionable data in raw nodes (debugging hints, modification guides)

---

## Revision History

| Date | Change | Author |
|------|--------|--------|
| 2025-12-30 | v7 benchmark - evaluated without prose generation | Claude |
