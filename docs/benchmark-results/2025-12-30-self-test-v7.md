# Benchmark Run: 2025-12-30 (v7 - Comprehensive 15 Tasks)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 38 files extracted, ~5.7k lines (source only)
- **Pith version**: 46c0adf
- **Model**: qwen/qwen-turbo
- **Tasks**: 15 (3 per category, full task bank)

## Pipeline Metrics

| Stage | Time | Notes |
|-------|------|-------|
| Extraction | 10.2s | 38 files extracted |
| Build | 3.1s | 132 nodes created (38 file, 84 function, 10 module) |
| Generation | 231.4s | 48 nodes with prose (files + modules) |
| **Total** | ~245s (~4 min) | Full pipeline with prose |

- Nodes created: 38 file, 84 function, 10 module (132 total)
- Nodes with prose: 48 (files + modules)
- Estimated cost: ~$0.50-1.00 (qwen-turbo)

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components
**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **19/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose provides module summaries (src/api, src/builder, etc.) with purpose, data flow, and key files. Control additionally identified 8 components with detailed line numbers and architectural patterns.

---

#### A2: Data Flow
**Question**: "Explain the data flow from file input to wiki output."

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **19/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose includes "Data Flow" sections describing how data enters/transforms/exits each module. Control provided more granular tracing with specific function calls and line numbers.

---

#### A3: Design Patterns
**Question**: "What design patterns are used in this codebase?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose mentions "Patterns" field in some nodes (e.g., "Node-based graph representation", "Memoization through pre-built file path maps"). Control identified 24 specific patterns with file:line references.

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache
**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **19/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose for extractor module mentions "cache.ts must be initialized with a cache directory before use" and function signatures show shouldExtract. Control explained complete SHA-256 logic with all line references.

---

#### B2: buildPrompt Function
**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows buildPrompt exists in generator module with function signature. Control documented full dispatch logic, file vs module prompts, and all helper functions with line numbers.

---

#### B3: LLM Retry Logic
**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose mentions "LLM integration is handled internally". Control provided specific: maxRetries=3, timeout=30000ms, exponential backoff formula, and all retryable error conditions with line references.

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact
**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **18/25** | **23/25** |

**Winner**: Control
**Notes**: Pith shows "Warning: Widely used (10 files depend on this)" for builder/index.ts. Control mapped all 10 importing files with specific line numbers and 62+ property access locations.

---

#### R2: API to Database
**Question**: "How do the API routes connect to the database layer?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **18/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose shows API module data flow: "Data enters via index.ts which parses HTTP requests...". Control traced complete flow with db.collection calls and query patterns.

---

#### R3: extractFile Consumers
**Question**: "What are all the consumers of the extractFile function?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows extractFile exists in ast.ts with import edges. Control found 1 production consumer (cli:181) and 42 test consumers with specific line numbers.

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose
**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose includes "Debugging" section with error patterns and key locations for generator. Control identified 6 specific root causes with line references and provided step-by-step debug guide.

---

#### D2: Slow Generation
**Question**: "Why might the generate command be slow?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose mentions "LLM integration" in generator. Control identified 8 specific bottlenecks: sequential processing, 30s timeout, exponential backoff, sequential DB updates, with line numbers.

---

#### D3: 404 for Existing File
**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith prose shows API gotchas for index.ts. Control found 4 specific causes: Windows path separators, import path resolution, missing normalization, with code evidence.

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support
**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith mentions "TypeScript extraction" in extractor purpose. Control identified 7 specific locations requiring changes with implementation plan.

---

#### M2: Rate Limiting
**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith shows API module with routes. Control provided complete implementation: middleware insertion point, route protection levels, code examples.

---

#### M3: Add Complexity Field
**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **23/25** |

**Winner**: Control
**Notes**: Pith shows WikiNode in builder with "Warning: Widely used". Control mapped all 10 files with specific lines for interface, creation functions, and tests.

---

## Summary

### Overall Scores

| Metric | Pith (with Prose) | Control |
|--------|-------------------|---------|
| **Average score** | **16.3/25 (65.2%)** | **23.9/25 (95.6%)** |
| Win/Loss/Tie | 0-15-0 | 15-0-0 |

### Score Breakdown by Category

| Category | Pith Avg | Control Avg | Gap |
|----------|----------|-------------|-----|
| Architecture (A1-A3) | 18.0 | 24.0 | -6.0 |
| Behavior (B1-B3) | 17.0 | 24.0 | -7.0 |
| Relationship (R1-R3) | 17.3 | 23.7 | -6.4 |
| Debugging (D1-D3) | 16.0 | 24.0 | -8.0 |
| Modification (M1-M3) | 14.0 | 23.7 | **-9.7** |

### Score Breakdown by Criterion

| Criterion | Pith Avg | Control Avg | Gap |
|-----------|----------|-------------|-----|
| Relevance | 3.3 | 5.0 | -1.7 |
| Completeness | 2.3 | 5.0 | **-2.7** |
| Accuracy | 4.0 | 5.0 | -1.0 |
| Efficiency | 5.0 | 3.9 | **+1.1** |
| Actionability | 2.1 | 5.0 | **-2.9** |

### Comparison to Previous Runs

| Metric | v6 (15 tasks) | v7 Raw Data | v7 With Prose |
|--------|---------------|-------------|---------------|
| Pith Average | 15.7/25 (63%) | 12.9/25 (52%) | **16.3/25 (65%)** |
| Control Average | 23.9/25 (96%) | 23.9/25 (96%) | **23.9/25 (96%)** |
| Gap | -8.2 points | -11.0 points | **-7.6 points** |

**Key Finding**: With prose enabled, Pith scores 65% vs 52% without prose (+13%). This confirms prose generation adds significant value.

---

## Information Gap Analysis

### Pith Advantages

| Information Type | Pith | Control | Notes |
|------------------|------|---------|-------|
| Conciseness | 5.0/5 | 3.9/5 | Pith prose is focused |
| Token efficiency | ~2.5k avg | ~13k avg | 5x smaller |
| Retrieval speed | <100ms | 30-60s | Pre-built wiki |
| Module summaries | ✅ | ✅ | Both provide |
| Data flow explanations | ✅ | ✅ | Pith has "Data Flow" field |
| Gotchas/warnings | ✅ | ⚠️ | Pith surfaces proactively |
| Quick start examples | ✅ | ❌ | Pith prose includes |
| Fan-in warnings | ✅ | ❌ | "Widely used (10 files)" |

### Control Advantages

| Information Type | Pith | Control | Gap Severity |
|------------------|------|---------|--------------|
| Specific line numbers | ⚠️ Some | ✅ Complete | High |
| Design pattern identification | ⚠️ Partial | ✅ 24 patterns | High |
| Cross-file tracing | ⚠️ Edges | ✅ Complete | **Critical** |
| Root cause analysis | ⚠️ Gotchas | ✅ Detailed | High |
| Implementation guides | ❌ | ✅ Step-by-step | **Critical** |
| Consumer mapping | ⚠️ Count | ✅ All refs | High |
| Modification planning | ❌ | ✅ Change list | **Critical** |

---

## Key Conclusions

### 1. Prose Generation Improves Scores Significantly
- Raw data: 52% → With prose: 65% (+13%)
- Biggest improvements in Architecture (+4.3 points) and Debugging (+5 points)

### 2. Category Sensitivity Persists
- **Best**: Architecture (18/25) - module summaries and data flow help
- **Worst**: Modification (14/25) - still lacks implementation guidance

### 3. Core Gaps Remain
Even with prose, Pith struggles with:
- Specific line-by-line code references
- Implementation step-by-step guides
- Comprehensive consumer/impact mapping

### 4. Pith's Value Proposition
Pith provides:
- 5x token efficiency (2.5k vs 13k tokens)
- Sub-second retrieval vs 30-60s exploration
- Proactive gotchas and warnings
- Quick start code examples

But requires Control-style exploration for modification tasks.

---

## Recommendations

### For Pith Development (Priority Order)

1. **Critical - Enhanced impact analysis**: Include specific consumer locations, not just counts
2. **Critical - Implementation guides**: Add "How to modify" sections for key interfaces
3. **High - Line number precision**: Include more contextual line references in prose
4. **Medium - Pattern recognition**: Improve design pattern identification in prose
5. **Medium - Debugging enhancements**: More specific root cause analysis

### For Usage

1. **Use Pith for**: Quick orientation, architecture overview, finding gotchas
2. **Use Control for**: Implementation planning, debugging, modification tasks
3. **Combined approach**: Start with Pith for context, then use Control for details

---

## Revision History

| Date | Change | Author |
|------|--------|--------|
| 2025-12-30 | v7 benchmark - initial raw data evaluation | Claude |
| 2025-12-30 | v7 benchmark - updated with prose-enabled evaluation | Claude |
