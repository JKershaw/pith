# Benchmark Run: 2025-12-30 (v6 - Comprehensive 15 Tasks)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 24 files, ~11.8k lines
- **Pith version**: 7a3ce04
- **Model**: qwen/qwen-turbo
- **Tasks**: 15 (3 per category, full task bank)

## Pipeline Metrics

| Stage | Time | Notes |
|-------|------|-------|
| Extraction | 8.9s | 29 files extracted |
| Build | 2.2s | 100 nodes created (29 file, 61 function, 10 module) |
| Generation | 169.7s | 39 nodes with prose |
| **Total** | ~181s (~3 min) | |

- Nodes created: 29 file, 61 function, 10 module (100 total)
- Nodes with prose: 39 (files + modules only)
- Estimated cost: ~$0.50-1.00 (qwen-turbo)

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components
**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **19/25** | **24/25** |

**Winner**: Control
**Notes**: Pith provided module summaries with purpose descriptions. Control identified 8 components with line numbers, traced import chains, and mapped data flow.

---

#### A2: Data Flow
**Question**: "Explain the data flow from file input to wiki output."

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **19/25** | **24/25** |

**Winner**: Control
**Notes**: Pith described module-level flow generically ("Data enters via ast.ts, transforms, exits via git.ts"). Control traced 4 stages with specific transformations: Extract (ast.ts:305→git.ts→docs.ts), Build (builder:109-665), Generate (generator:80-88→608-704), Serve (api:456-667).

---

#### A3: Design Patterns
**Question**: "What design patterns are used in this codebase?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith mentioned no design patterns by name. Control identified 10 patterns: Builder (builder:109,204,279), Singleton (db:3-5,13), Factory (api:456), Strategy (generator:80-88), Repository (builder:180,251,317), Adapter (api:113,337), Config (config:43,64), Template Method (ast:305), Command (cli:42), Facade (api:34-105).

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache
**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 3/5 | 5/5 |
| Accuracy | 5/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 3/5 | 5/5 |
| **Total** | **20/25** | **24/25** |

**Winner**: Control
**Notes**: Pith showed cache.ts functions with signatures. Control provided complete logic: SHA-256 at cache.ts:26-30, shouldExtract at 85-100 (new file→true, hash mismatch→true), CLI integration at cli:143,154-159,217-220,236.

---

#### B2: buildPrompt Function
**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith listed buildPrompt in generator functions. Control traced full dispatch: buildPrompt (lines 80-88) → buildFilePrompt (128-255) with 6 sections (imports/exports/functions/git/jsdoc/keyStatements) vs buildModulePrompt (263-328) with child summaries. Documented helper functions formatFunctionForPrompt (112-121) and formatKeyStatements (95-105).

---

#### B3: LLM Retry Logic
**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith mentioned generator handles LLM calls. Control found: maxRetries=3 (line 614), timeout=30000ms (line 615), exponential backoff 2^attempt*1000ms (lines 667,693), retryable errors at lines 581-600 (429, 5xx, AbortError, network errors).

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact
**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **23/25** |

**Winner**: Control
**Notes**: Pith showed "Warning: Widely used (8 files depend on this)". Control mapped 62 specific locations: builder (69-102 def, 109-521 usage), generator (1,80,128,263,493,567,720,752-860), api (2,20,34-446), cli (31,316-451), plus 4 test files with 50+ fixtures.

---

#### R2: API to Database
**Question**: "How do the API routes connect to the database layer?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 4/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **17/25** | **24/25** |

**Winner**: Control
**Notes**: Pith described API and DB modules separately. Control traced: getDb() at db:13-29 (singleton), createApp(db) at api:456, route handlers with db.collection at api:474-475 (/node), api:39,45,90 (/context), api:558,571 (/impact), cli:677,706 (injection).

---

#### R3: extractFile Consumers
**Question**: "What are all the consumers of the extractFile function?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith showed extractFile in ast.ts function list. Control found: definition at ast.ts:305, 1 production consumer (cli:179 in Promise.allSettled batch), 9 test consumers (ast.test.ts lines 48,55,64,78,100,131,145,172,193).

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose
**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith mentioned generator module. Control identified 6 root causes: JSON parsing at generator:334-356, missing fields at 359-363, empty strings passing validation (no check!), API failures at 687-704, child filtering at 844-846, response coercion. Provided 6-step debug guide.

---

#### D2: Slow Generation
**Question**: "Why might the generate command be slow?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | **16/25** | **24/25** |

**Winner**: Control
**Notes**: Pith mentioned LLM calls. Control identified 7 bottlenecks: sequential processing (cli:579-619), 30s timeout (generator:615), exponential backoff (667,693), sequential DB updates (759-761, cli:605), child prose dependency (838-840), per-module queries (cli:593-595), no batch validation (737-741).

---

#### D3: 404 for Existing File
**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **14/25** | **24/25** |

**Winner**: Control
**Notes**: Pith described API module generically. Control found 6 causes: path separator mismatch (ast:257, cli:338,371,395), file exclusion (ast:260-263, config:46-51), import resolution (builder:380-429), stale cache (cache:85-100), cache key mismatch (cache:93), module node not created (cli:346-347).

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support
**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith described "TypeScript extraction". Control identified 7+ locations: ast.ts:256 (extension filter), config:45-48 (patterns), builder:532,574-607 (test detection), builder:412,423,266 (resolution), cli:85,122 (descriptions). Provided 9-phase plan with parser recommendations.

---

#### M2: Rate Limiting
**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith described API module. Control provided implementation: middleware at api:463 (after express.json), config at config:32-36, env vars, cli:706 integration. Included code examples and dependency recommendation (express-rate-limit).

---

#### M3: Add Complexity Field
**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | **13/25** | **24/25** |

**Winner**: Control
**Notes**: Pith showed WikiNode interface location. Control mapped: type at builder:69-102, builders at 109-173,204-244,279-310, computation at 505-522, API at 113-317, plus 4 test files with 50+ fixture locations.

---

## Summary

### Overall Scores

| Metric | Pith | Control |
|--------|------|---------|
| **Average score** | **15.7/25 (62.8%)** | **23.9/25 (95.6%)** |
| Win/Loss/Tie | 0-15-0 | 15-0-0 |

### Score Breakdown by Category

| Category | Pith Avg | Control Avg | Gap |
|----------|----------|-------------|-----|
| Architecture (A1-A3) | 17.0 | 24.0 | -7.0 |
| Behavior (B1-B3) | 17.3 | 24.0 | -6.7 |
| Relationship (R1-R3) | 16.3 | 23.7 | -7.4 |
| Debugging (D1-D3) | 15.3 | 24.0 | -8.7 |
| Modification (M1-M3) | 13.0 | 24.0 | **-11.0** |

### Score Breakdown by Criterion

| Criterion | Pith Avg | Control Avg | Gap |
|-----------|----------|-------------|-----|
| Relevance | 3.0 | 5.0 | -2.0 |
| Completeness | 1.9 | 5.0 | **-3.1** |
| Accuracy | 4.1 | 5.0 | -0.9 |
| Efficiency | 5.0 | 4.0 | **+1.0** |
| Actionability | 1.8 | 5.0 | **-3.2** |

### Comparison to Previous Runs

| Metric | v4 (5 tasks) | v5 (15 tasks) | v6 (15 tasks) |
|--------|--------------|---------------|---------------|
| Pith Average | 14.4/25 | 15.5/25 | **15.7/25** |
| Control Average | 23.8/25 | 23.9/25 | **23.9/25** |
| Pith Win Rate | 0% | 0% | **0%** |
| Statistical Confidence | Low | Medium | **Medium** |

**Note**: v6 confirms v5 findings with consistent methodology. Pith averages ~63% while Control maintains ~96%.

---

## Information Gap Analysis

### Pith Advantages

| Information Type | Pith | Control | Notes |
|------------------|------|---------|-------|
| Conciseness | ✅ 5.0/5 | 4.0/5 | Pith prose is focused |
| Token efficiency | ~2.5k avg | ~3.5k avg | Pith uses ~29% fewer tokens |
| Retrieval speed | <100ms | 30-60s | Pre-built wiki vs exploration |
| Git metadata | ✅ | ❌ | Commits, authors, dates |
| Fan-in/out metrics | ✅ | ❌ | Dependency counts |
| Quick start examples | ✅ | ❌ | Code snippets for usage |

### Control Advantages

| Information Type | Pith | Control | Gap Severity |
|------------------|------|---------|--------------|
| Design pattern identification | ❌ | ✅ 10 patterns | **Critical** |
| Line number references | ⚠️ Listed | ✅ Contextual | High |
| Cross-file tracing | ❌ | ✅ Complete | **Critical** |
| Root cause analysis | ❌ | ✅ 6-7 causes | **Critical** |
| Implementation guides | ❌ | ✅ Step-by-step | **Critical** |
| Consumer mapping | ⚠️ Count only | ✅ All refs | **Critical** |
| Specific config values | ❌ | ✅ Exact constants | High |
| Change impact details | ⚠️ Warning | ✅ 50+ locations | **Critical** |

---

## Task Type Analysis

### Where Pith Performs Best (17+ score)

| Task | Type | Pith Score | Why |
|------|------|------------|-----|
| A1: Main Components | Architecture | 19/25 | Module summaries align with question |
| A2: Data Flow | Architecture | 19/25 | Data flow descriptions in prose |
| B1: Cache Behavior | Behavior | 20/25 | Function signatures and gotchas help |

### Where Pith Struggles Most (<14 score)

| Task | Type | Pith Score | Why |
|------|------|------------|-----|
| A3: Design Patterns | Architecture | 13/25 | No pattern recognition in prompts |
| M1: JS Support | Modification | 13/25 | Can't identify language-specific code |
| M2: Rate Limiting | Modification | 13/25 | No implementation guidance |
| M3: Add Field | Modification | 13/25 | No change impact analysis |
| D3: 404 Debugging | Debugging | 14/25 | Generic gotchas, no error path tracing |

---

## Key Conclusions

### 1. Consistent Performance Gap
With 15 tasks, Pith consistently scores **~63%** while Control scores **~96%**. This 33-point gap is consistent across all categories.

### 2. Category Sensitivity
- **Best**: Architecture/Behavior tasks (17-20/25) where module summaries provide value
- **Worst**: Modification tasks (13/25) requiring cross-file analysis and implementation guides

### 3. Fundamental Limitations
Pith cannot currently:
- Identify design patterns across files
- Trace error paths and debugging flows
- Map change impacts for modifications
- Provide implementation step-by-step guides
- Cross-reference specific values (timeouts, retry counts)

### 4. Pith's Value Proposition
Despite lower scores, Pith provides:
- 29% token efficiency
- Sub-second retrieval vs 30-60s exploration
- Unique metadata (git history, fan-in/out)
- Consistent orientation context

---

## Recommendations

### For Pith Development (Priority Order)

1. **Critical - Add pattern recognition**: Include design pattern identification in prose prompts
2. **Critical - Add change impact sections**: For high-fan-in files, list specific consumer locations
3. **Critical - Enhanced cross-file tracing**: Build data flow and dependency chains into prose
4. **High - Add debugging guides**: Include root cause analysis and debug steps
5. **High - Include modification guidance**: For key interfaces, list required change locations
6. **Medium - Cross-reference values**: Include important constants in prose

### For Benchmark Methodology

1. **Always run all 15 tasks** for statistical significance
2. **Track per-category scores** to identify improvements
3. **Compare Completeness and Actionability** as key differentiators
4. **Monitor token efficiency** - Pith's advantage matters for context windows

---

## Revision History

| Date | Change | Author |
|------|--------|--------|
| 2025-12-30 | v6 comprehensive benchmark with all 15 tasks | Claude |
