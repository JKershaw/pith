# Benchmark Run: 2026-01-03 (Query Mode Self-Test)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 52 files extracted, ~25k lines (source only)
- **Pith version**: 7c36b5f (current HEAD)
- **Model**: qwen/qwen-turbo
- **Tasks**: 15 (3 per category, full task bank)
- **Mode**: **Query Mode** (`POST /query`) - Uses navigator for file selection and answer synthesis

## Pipeline Metrics

| Stage      | Time              | Notes                                                |
| ---------- | ----------------- | ---------------------------------------------------- |
| Extraction | 16.7s (19.9s tot) | 52 files extracted                                   |
| Build      | 4.5s (8.0s tot)   | 187 nodes created (52 file, 124 function, 11 module) |
| Generation | 71.3s (~1.2 min)  | 60 nodes with prose (3 errors - JSON parsing issues) |
| **Total**  | ~99s (~1.7 min)   | Full pipeline with prose                             |

- Nodes created: 52 file, 124 function, 11 module (187 total)
- Nodes with prose: 60/63 (files + modules)
- Generation errors: 3 (JSON parsing from LLM response)
- Estimated cost: ~$0.30-0.50 (qwen-turbo)

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components

**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 3/5          | 4/5       |
| **Total**    | **15/20**    | **19/20** |

**Winner**: Control
**Files selected**: 11 files (api, builder, cli, config, generator, query, extractor modules)
**Notes**: Pith correctly identified 7 main components with file paths. Control provided more detailed breakdown with 7+ components plus interaction diagram and specific line references for key functions.

---

#### A2: Data Flow

**Question**: "Explain the data flow from file input to wiki output."

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 5/5          | 5/5       |
| Completeness | 5/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **18/20**    | **19/20** |

**Winner**: Control
**Files selected**: extractor/ast.ts, builder/index.ts, generator/index.ts, api/index.ts
**Notes**: Pith provided good 4-stage pipeline with file references. Control traced complete flow with specific file:line references (extractFile:557, buildFileNode:159, generateProse:846, createApp:887).

---

#### A3: Design Patterns

**Question**: "What design patterns are used in this codebase?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 3/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **15/20**    | **19/20** |

**Winner**: Control
**Files selected**: patterns.ts, patterns.test.ts
**Notes**: Pith focused on patterns the codebase _detects_ (Retry, Cache, Builder, Singleton) rather than patterns it _uses_. Control identified 8+ architectural patterns (Singleton, Repository, Factory, Strategy, Decorator, Observer, Chain of Responsibility) with file:line references.

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache

**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 5/5          | 5/5       |
| Completeness | 5/5          | 5/5       |
| Specificity  | 5/5          | 5/5       |
| Conciseness  | 5/5          | 5/5       |
| **Total**    | **20/20**    | **20/20** |

**Winner**: Tie
**Files selected**: cache.ts, ast.ts
**Notes**: **Perfect scores for both!** Pith correctly identified SHA-256 hashing at `getFileHash:26-30`, `shouldExtract:85-100`, and explained the exact decision logic. Matches Control's comprehensiveness.

---

#### B2: buildPrompt Function

**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: generator/index.ts
**Notes**: Pith found buildPrompt at lines 83-91 and mentioned dispatch to buildFilePrompt/buildModulePrompt. Control documented full dispatch logic, file vs module prompt templates (lines 131-276 vs 284-352), and helper functions.

---

#### B3: LLM Retry Logic

**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 5/5       |
| **Total**    | **16/20**    | **20/20** |

**Winner**: Control
**Files selected**: generator/index.ts
**Notes**: Pith answer was truncated but identified callLLM and retry concepts. Control found complete details: maxRetries=3 (line 738), timeout=30s (line 739), exponential backoff 2^attempt \* 1000ms (lines 791-793), isRetryableError conditions (lines 703-724).

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact

**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 5/5          | 5/5       |
| Completeness | 5/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **18/20**    | **19/20** |

**Winner**: Control
**Files selected**: 17 files (production + tests)
**Notes**: Pith identified 17 affected files with good coverage. Control provided same files plus specific line numbers for type usage locations in each file.

---

#### R2: API to Database

**Question**: "How do the API routes connect to the database layer?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: api/index.ts, db/index.ts
**Notes**: Pith found getDb and getCollection with line references. Control traced complete flow with 6 specific route→collection mappings (lines 899, 981, 1026, 1100, 1149, 1188).

---

#### R3: extractFile Consumers

**Question**: "What are all the consumers of the extractFile function?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 3/5          | 5/5       |
| Completeness | 2/5          | 5/5       |
| Specificity  | 2/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **11/20**    | **19/20** |

**Winner**: Control
**Files selected**: Multiple files via importers target
**Notes**: **Key limitation exposed.** Pith listed 5 files as "potential consumers" without line numbers and hedged with "may import." Control found 1 production consumer (cli:186) + 52 test call sites with exact line numbers across 3 test files.

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose

**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: generator/index.ts, query/overview.ts
**Notes**: Pith identified generateProse (846-869), parseLLMResponse (358-441). Control found specific validation gap at lines 382-388 (checks type but not content length), storage without validation at line 878.

---

#### D2: Slow Generation

**Question**: "Why might the generate command be slow?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 3/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **15/20**    | **19/20** |

**Winner**: Control
**Files selected**: generator/index.ts
**Notes**: Pith answer truncated, mentioned LLM calls with retries. Control found **key bottleneck**: sequential Phase 1→Phase 2 (lines 660-696), 30s timeout + exponential backoff (lines 738-793), default concurrency=5 (lines 514-518).

---

#### D3: 404 for Existing File

**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: api/index.ts, builder/index.ts, builder/cross-file-calls.ts
**Notes**: Pith found fuzzy matching and 404 logic in createApp. Control identified 5 specific causes: case-sensitive exact match (line 906), fuzzy thresholds (AUTO=0.7, SUGGESTION=0.4 at fuzzy.ts:270,273), cross-module penalty (-30 points at fuzzy.ts:157-181).

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support

**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 3/5          | 5/5       |
| Completeness | 2/5          | 5/5       |
| Specificity  | 3/5          | 5/5       |
| Conciseness  | 4/5          | 3/5       |
| **Total**    | **12/20**    | **18/20** |

**Winner**: Control
**Files selected**: cli/index.ts, extractor/ast.ts, tsup.config.ts
**Notes**: Pith found findFiles in ast.ts and suggested updating include pattern. Control found **40+ hardcoded locations** across 16 files: ast.ts:458,459,473, builder/index.ts:614,656,667,678,689, cross-file-calls.ts:88, config/index.ts:45, eslint.config.js:8,23, package.json:14,55,59.

---

#### M2: Rate Limiting

**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: api/index.ts
**Notes**: Pith found createApp and middleware discussion via formatContextAsMarkdown. Control listed all 6 routes with insertion points (lines 899, 981, 1026, 1100, 1149, 1188) and noted only current middleware is express.json() at line 894.

---

#### M3: Add Complexity Field

**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion    | Pith (Query) | Control   |
| ------------ | ------------ | --------- |
| Correctness  | 4/5          | 5/5       |
| Completeness | 4/5          | 5/5       |
| Specificity  | 4/5          | 5/5       |
| Conciseness  | 4/5          | 4/5       |
| **Total**    | **16/20**    | **19/20** |

**Winner**: Control
**Files selected**: 10 files (builder, extractor, query, api modules)
**Notes**: Pith identified files using WikiNode via grep. Control provided complete list: interface (builder/index.ts:115-152), 3 builder functions (lines 159, 282, 357), computeMetadata (line 587), storage functions (lines 258, 329, 395), plus 5 test files.

---

## Summary

### Overall Scores

| Metric            | Pith (Query)        | Control             |
| ----------------- | ------------------- | ------------------- |
| **Average score** | **15.7/20 (78.7%)** | **19.1/20 (95.3%)** |
| Win/Loss/Tie      | 0-14-1              | 14-0-1              |

### Score Breakdown by Category

| Category             | Pith Avg | Control Avg | Gap  |
| -------------------- | -------- | ----------- | ---- |
| Architecture (A1-A3) | 16.0     | 19.0        | -3.0 |
| Behavior (B1-B3)     | 17.3     | 19.7        | -2.4 |
| Relationship (R1-R3) | 15.0     | 19.0        | -4.0 |
| Debugging (D1-D3)    | 15.7     | 19.0        | -3.3 |
| Modification (M1-M3) | 14.7     | 18.7        | -4.0 |

### Score Breakdown by Criterion

| Criterion    | Pith Avg | Control Avg | Gap  |
| ------------ | -------- | ----------- | ---- |
| Correctness  | 4.1      | 5.0         | -0.9 |
| Completeness | 3.8      | 5.0         | -1.2 |
| Specificity  | 3.9      | 5.0         | -1.1 |
| Conciseness  | 4.0      | 4.1         | -0.1 |

### Comparison to Previous Benchmarks

| Metric          | 2026-01-01      | 2026-01-02      | This Run (2026-01-03) | Delta from 01-02 |
| --------------- | --------------- | --------------- | --------------------- | ---------------- |
| Pith Average    | 72.8% (18.2/25) | 82.0% (16.4/20) | **78.7% (15.7/20)**   | -3.3%            |
| Control Average | 96.4% (24.1/25) | 95.5% (19.1/20) | **95.3% (19.1/20)**   | -0.2%            |
| Gap             | -23.6%          | -13.5%          | **-16.6%**            | -3.1%            |
| Ties            | 1               | 3               | **1**                 | -2 ties          |

---

## Key Observations

### 1. Performance Regression from 2026-01-02

- **Pith average dropped**: 82.0% → 78.7% (-3.3%)
- **Ties reduced**: 3 → 1 (only B1 remained a tie)
- **Possible causes**:
  - Generation errors (3 nodes failed with JSON parsing)
  - Different node count (178 → 187 nodes)
  - Query response truncation visible in B3, D2

### 2. Persistent Strength: Technical Behavior Tasks

- **B1 (Cache Logic)**: Perfect 20/20 tie - Pith excels at explaining specific technical mechanisms
- B2, B3 close scores (16/20) - Good at identifying key functions

### 3. Persistent Weaknesses

| Weakness                 | Example Task | Pith Finding            | Control Finding                    |
| ------------------------ | ------------ | ----------------------- | ---------------------------------- |
| Function-level consumers | R3           | 5 "potential" files     | 53 call sites with line numbers    |
| Modification enumeration | M1           | 3-4 locations           | 40+ locations across 16 files      |
| Comparative debugging    | D2           | General slowness causes | Key bottleneck (sequential phases) |

### 4. Answer Truncation Issues

Several Pith responses were truncated in the JSON output:

- B3: Missing retry condition details
- D2: Missing bottleneck analysis
- M1: Incomplete file list

---

## Information Gap Analysis

### Information Type Comparison

| Information Type            | Pith | Control | Gap Severity |
| --------------------------- | :--: | :-----: | :----------: |
| Module/file names           |  ✅  |   ✅    |     None     |
| One-line summary            |  ✅  | Partial |     None     |
| Purpose description         |  ✅  | Partial |     None     |
| Line number references      |  ✅  |   ✅    |    Minor     |
| Function signatures         |  ✅  |   ✅    |     None     |
| Implementation details      |  ⚠️  |   ✅    |    Medium    |
| Function-level consumers    |  ❌  |   ✅    |   Critical   |
| Complete change enumeration |  ❌  |   ✅    |     High     |
| Comparative analysis        |  ⚠️  |   ✅    |    Medium    |

---

## Key Conclusions

### 1. Slight Regression from Previous Run

- -3.3% absolute decrease in Pith scores
- 2 fewer ties (3 → 1)
- Possible contributing factors: generation errors, response truncation

### 2. B1 Remains Strong

- Cache mechanism task achieved **perfect 20/20 tie**
- Demonstrates Pith excels at focused technical questions

### 3. Relationship & Modification Tasks Remain Weak

- R3 (function consumers): 11/20 vs 19/20 (-8 points)
- M1 (JS support): 12/20 vs 18/20 (-6 points)
- Core limitation: cannot enumerate all usage sites

### 4. Recommendations

| Priority | Improvement                         | Impact                    |
| -------- | ----------------------------------- | ------------------------- |
| High     | Add function consumer index         | Fixes R3-type queries     |
| High     | Enumerate hardcoded values in wiki  | Improves M1-type tasks    |
| Medium   | Increase response token limits      | Prevents truncation       |
| Medium   | Add comparative analysis in prose   | Improves debugging tasks  |
| Low      | Improve JSON parsing error handling | Reduces generation errors |

---

## Revision History

| Date       | Change                                             | Author |
| ---------- | -------------------------------------------------- | ------ |
| 2026-01-03 | Benchmark run showing slight regression from 01-02 | Claude |
