# Benchmark Run: 2025-12-31 (Self-Test v4)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 43 files extracted, ~18k lines (source only)
- **Pith version**: c536fba
- **Model**: qwen/qwen-turbo
- **Tasks**: 15 (3 per category, full task bank)

## Pipeline Metrics

| Stage      | Time              | Notes                                               |
| ---------- | ----------------- | --------------------------------------------------- |
| Extraction | 13.5s             | 43 files extracted                                  |
| Build      | 2.9s              | 151 nodes created (43 file, 98 function, 10 module) |
| Generation | 227.7s (~3.8 min) | 53 nodes with prose (files + modules)               |
| **Total**  | ~244s (~4.1 min)  | Full pipeline with prose                            |

- Nodes created: 43 file, 98 function, 10 module (151 total)
- Nodes with prose: 53 (files + modules)
- Estimated cost: ~$0.50-1.00 (qwen-turbo)

---

## Task Results

### Architecture Tasks (A1-A3)

#### A1: Main Components

**Question**: "What are the main components of this codebase and how do they interact?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 5/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **19/25** | **25/25** |

**Winner**: Control
**Pith tokens**: 32,339 | **Control tokens**: 5,150
**Notes**: Control found all components efficiently with 6x fewer tokens. Pith provided comprehensive docs but included excessive detail not needed for architecture overview.

---

#### A2: Data Flow

**Question**: "Explain the data flow from file input to wiki output."

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 5/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **19/25** | **25/25** |

**Winner**: Control
**Pith tokens**: 23,729 | **Control tokens**: 10,500
**Notes**: Control traced the complete 4-stage flow (Extract→Build→Generate→Serve) with 2.3x fewer tokens. Pith returned comprehensive but verbose context.

---

#### A3: Design Patterns

**Question**: "What design patterns are used in this codebase?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **19/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 26,773 | **Control tokens**: 18,500
**Notes**: Control identified 11 design patterns (Builder, Factory, Repository, Visitor, Strategy, Adapter, Facade, Chain of Responsibility, Caching, Template Method, Configuration) with specific line references. Pith provided general documentation.

---

### Specific Behavior Tasks (B1-B3)

#### B1: Extraction Cache

**Question**: "How does the extraction cache determine if a file needs re-extraction?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 5/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 5/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **21/25** | **25/25** |

**Winner**: Control
**Pith tokens**: 1,962 | **Control tokens**: 1,100
**Notes**: Both correctly identified SHA-256 content hashing. Control explained the logic more concisely with 44% fewer tokens. Pith's best performance on token efficiency.

---

#### B2: buildPrompt Function

**Question**: "How does buildPrompt construct LLM prompts for different node types?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 5/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **25/25** |

**Winner**: Control
**Pith tokens**: 13,093 | **Control tokens**: 4,200
**Notes**: Control found buildPrompt dispatcher and explained file vs module prompt differences with specific line numbers. Pith returned the full generator file without targeting the specific function.

---

#### B3: LLM Retry Logic

**Question**: "What is the retry logic in the LLM client and what triggers a retry?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 5/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **20/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 13,079 | **Control tokens**: 8,400
**Notes**: Both found the retry logic (max 3 attempts, exponential backoff, retries on 429/5xx/network errors). Control was 36% more token-efficient and provided test verification.

---

### Relationship Tasks (R1-R3)

#### R1: WikiNode Impact

**Question**: "What files would be affected if I changed the WikiNode interface?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 5/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 4/5       | 3/5       |
| Actionability | 5/5       | 5/5       |
| **Total**     | **23/25** | **23/25** |

**Winner**: Tie
**Pith tokens**: ~200 (edges only) | **Control tokens**: 52,400
**Notes**: Pith's importedBy edges immediately showed 9 dependent files. Control found 11 files (including tests) but used 260x more tokens. Tie due to trade-off: Pith more efficient, Control more complete.

---

#### R2: API to Database

**Question**: "How do the API routes connect to the database layer?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 17,673 | **Control tokens**: 7,150
**Notes**: Control traced the dependency injection pattern (getDb→createApp→db.collection) with 2.5x fewer tokens. Pith returned verbose context that didn't highlight the connection pattern.

---

#### R3: extractFile Consumers

**Question**: "What are all the consumers of the extractFile function?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 2/5       | 5/5       |
| Accuracy      | 4/5       | 5/5       |
| Efficiency    | 2/5       | 5/5       |
| Actionability | 2/5       | 5/5       |
| **Total**     | **13/25** | **25/25** |

**Winner**: Control
**Pith tokens**: ~200 (edges) | **Control tokens**: 6,800
**Notes**: Pith showed 2 importedBy files (file-level only). Control found 48 call sites across 4 files with specific line numbers. **Critical gap**: Pith lacks function-level consumer tracking.

---

### Debugging Tasks (D1-D3)

#### D1: Empty Prose

**Question**: "Generation completes but some nodes have empty prose. What should I investigate?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **16/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 13,079 | **Control tokens**: 12,000
**Notes**: Control provided a complete debugging guide with 5 root causes and specific file:line references. Pith returned general context without debugging-specific insight.

---

#### D2: Slow Generation

**Question**: "Why might the generate command be slow?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 1/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **17/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 23,982 | **Control tokens**: 8,500
**Notes**: Control identified the key bottleneck (sequential LLM calls vs extract's BATCH_SIZE=4) with 2.8x fewer tokens. Pith missed this comparative insight.

---

#### D3: 404 for Existing File

**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **16/25** | **24/25** |

**Winner**: Control
**Pith tokens**: 16,024 | **Control tokens**: 10,000
**Notes**: Control found 4 specific 404 scenarios with line numbers. Pith returned API context without explaining the 404 logic.

---

### Modification Tasks (M1-M3)

#### M1: JavaScript Support

**Question**: "How would I add support for JavaScript (.js) files in addition to TypeScript?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 3/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 4/5       | 5/5       |
| Efficiency    | 1/5       | 5/5       |
| Actionability | 2/5       | 5/5       |
| **Total**     | **13/25** | **25/25** |

**Winner**: Control
**Pith tokens**: 27,055 | **Control tokens**: 5,500
**Notes**: Control found 15 specific locations where .ts extension is hardcoded (config, AST, builder, cross-file-calls). Pith returned related files but without targeted modification points.

---

#### M2: Rate Limiting

**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 4/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 2/5       | 3/5       |
| Actionability | 4/5       | 5/5       |
| **Total**     | **19/25** | **23/25** |

**Winner**: Control
**Pith tokens**: 16,024 | **Control tokens**: 24,000
**Notes**: Control provided a complete implementation guide with code examples. Pith returned API context that shows the insertion points but without implementation guidance.

---

#### M3: Add Complexity Field

**Question**: "I want to add a 'complexity' field to WikiNode. What files need changes?"

| Criterion     | Pith      | Control   |
| ------------- | --------- | --------- |
| Relevance     | 4/5       | 5/5       |
| Completeness  | 3/5       | 5/5       |
| Accuracy      | 5/5       | 5/5       |
| Efficiency    | 3/5       | 4/5       |
| Actionability | 3/5       | 5/5       |
| **Total**     | **18/25** | **24/25** |

**Winner**: Control
**Pith tokens**: ~200 (edges) | **Control tokens**: 15,000
**Notes**: Pith showed 9 files via importedBy edges. Control provided specific file:line locations for type definition, node creation, and metadata computation.

---

## Summary

### Overall Scores

| Metric            | Pith                | Control             |
| ----------------- | ------------------- | ------------------- |
| **Average score** | **17.8/25 (71.2%)** | **24.0/25 (96.0%)** |
| Win/Loss/Tie      | 0-14-1              | 14-0-1              |

### Score Breakdown by Category

| Category             | Pith Avg | Control Avg | Gap  |
| -------------------- | -------- | ----------- | ---- |
| Architecture (A1-A3) | 19.0     | 24.7        | -5.7 |
| Behavior (B1-B3)     | 19.3     | 24.7        | -5.4 |
| Relationship (R1-R3) | 17.7     | 24.0        | -6.3 |
| Debugging (D1-D3)    | 16.3     | 24.0        | -7.7 |
| Modification (M1-M3) | 16.7     | 24.0        | -7.3 |

### Score Breakdown by Criterion

| Criterion     | Pith Avg | Control Avg | Gap  |
| ------------- | -------- | ----------- | ---- |
| Relevance     | 3.7      | 5.0         | -1.3 |
| Completeness  | 3.6      | 5.0         | -1.4 |
| Accuracy      | 4.9      | 5.0         | -0.1 |
| Efficiency    | 2.1      | 4.3         | -2.2 |
| Actionability | 3.5      | 5.0         | -1.5 |

### Token Usage Comparison

| Metric              | Pith    | Control | Ratio |
| ------------------- | ------- | ------- | ----- |
| Total tokens        | 224,412 | 189,200 | 1.2x  |
| Average per task    | 14,961  | 12,613  | 1.2x  |
| Most efficient task | 200     | 1,100   | B1/R1 |
| Least efficient     | 27,055  | 52,400  | M1/R1 |

### Comparison to Previous Benchmarks

| Metric          | v2 (2025-12-31) | v3 (2025-12-31) | This Run (v4) | Change from v3 |
| --------------- | --------------- | --------------- | ------------- | -------------- |
| Pith Average    | 16.8/25 (67%)   | 16.3/25 (65%)   | 17.8/25 (71%) | **+6%**        |
| Control Average | 23.3/25 (93%)   | 24.5/25 (98%)   | 24.0/25 (96%) | -2%            |
| Gap             | -6.5 points     | -8.2 points     | -6.2 points   | **+2.0**       |
| Pith Win Rate   | 1-13-1          | 0-15-0          | 0-14-1        | **+1 tie**     |

---

## Information Gap Analysis

### Critical Issues Identified

| Issue                          | Impact | Examples                                                     |
| ------------------------------ | ------ | ------------------------------------------------------------ |
| **Token inefficiency**         | High   | Average 1.2x more tokens; worst case 4.9x (M1)               |
| **Missing targeted context**   | High   | B2, D1, D2: Returns full files instead of specific functions |
| **File-level vs symbol-level** | High   | R3: importedBy shows 2 files but only 1 production consumer  |
| **No debugging insights**      | Medium | D1, D2, D3: Prose doesn't highlight debugging-relevant info  |

### Information Type Comparison

| Information Type       |  Pith   | Control | Gap Severity |
| ---------------------- | :-----: | :-----: | :----------: |
| Module/file names      |   ✅    |   ✅    |     None     |
| One-line summary       |   ✅    | Partial |     None     |
| Purpose description    |   ✅    | Partial |     None     |
| Gotchas/warnings       |   ✅    |   ❌    |    Minor     |
| Import relationships   |   ✅    |   ✅    |     None     |
| Fan-in/fan-out metrics |   ✅    |   ❌    |    Minor     |
| Line numbers           | Partial |   ✅    |    Medium    |
| Code snippets          | Partial |   ✅    |     High     |
| Function signatures    |   ✅    |   ✅    |     None     |
| Implementation details |   ❌    |   ✅    |   Critical   |
| Cross-file flows       |   ❌    |   ✅    |     High     |
| Symbol-level tracking  |   ❌    |   ✅    |     High     |
| Targeted searches      |   ❌    |   ✅    |   Critical   |

---

## Key Conclusions

### 1. Improvement from v3

- **Pith score improved**: 65% → **71%** (+6%)
- **Gap narrowed**: 8.2 → **6.2 points**
- **First tie in 2 runs**: R1 (WikiNode Impact) scored equally

### 2. Pith Strengths

- **Accuracy**: 4.9/5 average - information provided is correct
- **Pre-computed dependencies**: importedBy edges provide instant file impact analysis
- **Structured metadata**: fanIn/fanOut, git history, gotchas
- **Good for B1, R1**: Cache logic and dependency queries match Pith's strengths

### 3. Persistent Weaknesses

- **Efficiency**: 2.1/5 average - still returns too much context
- **Targeting**: Returns full files instead of specific functions/sections
- **Symbol-level tracking**: Cannot identify function-level consumers (R3)
- **Debugging guidance**: Prose doesn't highlight debugging-relevant info (D1-D3)

### 4. Control's Consistent Strengths

- Near-perfect scores across all criteria
- Targeted searches with grep/glob
- Symbol-level precision with line numbers
- Cross-file flow tracing

---

## Recommendations

### For Pith Development (Priority Order)

1. **High - Response targeting**: Return relevant sections, not full files
2. **High - Symbol tracking**: Track function/type consumers, not just file imports
3. **Medium - Debugging mode**: Add prose sections for common debugging scenarios
4. **Medium - Query routing**: Better context bundling for different query types

### For Benchmark Methodology

1. Track token efficiency ratio as a key metric
2. Add tie-breaker criteria for close scores
3. Consider weighted scoring for different use cases

---

## Revision History

| Date       | Change           | Author |
| ---------- | ---------------- | ------ |
| 2025-12-31 | v4 benchmark run | Claude |
