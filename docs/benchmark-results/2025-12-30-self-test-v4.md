# Benchmark Run: 2025-12-30 (Fourth Run)

## Configuration

- **Repository**: Pith (self-test)
- **Size**: 24 files, ~10.7k lines
- **Pith version**: afc708e (after PR #16 merge with refined LLM prompts)
- **Model**: qwen/qwen-turbo

## Pipeline Metrics

| Stage | Time | Notes |
|-------|------|-------|
| Extraction | 8.9s | 29 files extracted |
| Build | 2.1s | 96 nodes created |
| Generation | 167.8s | 39 nodes with prose |
| **Total** | ~179s | |

- Nodes created: 29 file, 57 function, 10 module (96 total)
- Nodes with prose: 39 (files + modules only)
- Estimated cost: ~$0.50-1.00 (qwen-turbo pricing)

## Task Results

### Task 1: Architecture
**Question**: "What design patterns are used in this codebase?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | 13/25 | 24/25 |

- **Winner**: Control
- **Pith tokens**: ~2,800 (8 modules)
- **Control tokens**: ~4,500
- **Notes**: Pith provided module summaries describing purpose generically (e.g., "provides functions to build and store graph nodes") without identifying any design patterns. Control identified 16 specific patterns with file:line references: Pipeline (cli:85-280), Builder (builder/index.ts multiple build* functions), Factory (api:319-323), Singleton (db:1-51), Strategy (generator:80-88), Retry with Exponential Backoff (generator:608-704), Cache (cache.ts), Visitor (ast.ts:149-231), and more.

---

### Task 2: Specific Behavior
**Question**: "How does the buildPrompt function construct LLM prompts for different node types?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | 16/25 | 24/25 |

- **Winner**: Control
- **Pith tokens**: ~1,600
- **Control tokens**: ~3,200
- **Notes**: Pith showed the generator module summary and listed buildPrompt in functions section with lines 80-88, but lacked details on what data is included. Control traced the full flow: buildPrompt (lines 80-88) dispatches to buildFilePrompt (lines 128-255) or buildModulePrompt (lines 263-328), with helper functions formatFunctionForPrompt (lines 112-121) and formatKeyStatements (lines 95-105). Control documented all prompt sections: IMPORTS, EXPORTS, FUNCTIONS, GIT, JSDOC, KEY VALUES FOUND.

---

### Task 3: Cross-Module Relationship
**Question**: "What are all the consumers of the WikiNode interface?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 2/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 3/5 |
| Actionability | 2/5 | 5/5 |
| **Total** | 16/25 | 23/25 |

- **Winner**: Control
- **Pith tokens**: ~2,800
- **Control tokens**: ~3,800
- **Notes**: Pith showed that builder/index.ts exports WikiNode (line 37-70) and that multiple files import from it (via Dependents field), but didn't trace how each consumer uses it. Control mapped complete consumer list: Builder (14 functions), CLI (lines 31, 316, 324, 345, 363, 444, 498, 678), Generator (10 functions with line numbers), API (lines 2, 12, 31-32, 56-78, 85-89, 337). Control also documented edge types and data flow from ExtractedFile → WikiNode → ProseData.

---

### Task 4: Debugging
**Question**: "API returns 404 for a file that exists. What could cause this?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 3/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | 14/25 | 24/25 |

- **Winner**: Control
- **Pith tokens**: ~2,000
- **Control tokens**: ~4,200
- **Notes**: Pith provided API module overview with generic gotchas like "Multiple unhandled error cases in API routes." Control created comprehensive debugging guide with 8 categories: (1) File never extracted - include/exclude patterns at ast.ts:260-263, (2) Cache issues at cache.ts:99, (3) Parse errors at cli:199-201, (4) Node not created at cli:304-309, (5) Node creation skipped, (6) Wrong ID stored - path separator mismatch at ast.ts:257, (7) API path parsing at api:333-334, (8) Database query issues at api:338. Control provided specific debug steps for each.

---

### Task 5: Modification
**Question**: "How would I add rate limiting to the API endpoints?"

| Criterion | Pith | Control |
|-----------|------|---------|
| Relevance | 2/5 | 5/5 |
| Completeness | 1/5 | 5/5 |
| Accuracy | 4/5 | 5/5 |
| Efficiency | 5/5 | 4/5 |
| Actionability | 1/5 | 5/5 |
| **Total** | 13/25 | 24/25 |

- **Winner**: Control
- **Pith tokens**: ~2,800
- **Control tokens**: ~5,000
- **Notes**: Pith described the API module purpose and CLI module purpose generically with no rate limiting guidance. Control provided complete implementation guide: (1) Add express-rate-limit to package.json, (2) Create RateLimitConfig interface at config:27, update PithConfig at config:32-36, (3) Update createApp at api:319-323 to accept rateLimitConfig, (4) Add middleware after api:326, (5) Add CLI options at cli:665-667, (6) Include code examples, insertion points, and design considerations.

---

## Summary

| Metric | Pith | Control |
|--------|------|---------|
| Average score | 14.4/25 | 23.8/25 |
| Win/Loss/Tie | 0-5-0 | 5-0-0 |

### Score Breakdown by Criterion

| Criterion | Pith Avg | Control Avg |
|-----------|----------|-------------|
| Relevance | 2.6 | 5.0 |
| Completeness | 1.4 | 5.0 |
| Accuracy | 4.0 | 5.0 |
| Efficiency | 5.0 | 3.8 |
| Actionability | 1.4 | 5.0 |

### Comparison to Previous Runs

| Metric | v1 (12/30) | v2 (12/30) | v3 (12/30) | v4 (12/30) | Change |
|--------|------------|------------|------------|------------|--------|
| Pith Average | 12.6/25 | 12.6/25 | 16.6/25 | 14.4/25 | **-2.2** |
| Control Average | 24.2/25 | 24.4/25 | 23.8/25 | 23.8/25 | No change |
| Pith Relevance | 2.4 | 2.6 | 3.0 | 2.6 | -0.4 |
| Pith Completeness | 1.8 | 1.8 | 2.0 | 1.4 | **-0.6** |
| Pith Accuracy | 3.6 | 3.6 | 4.6 | 4.0 | -0.6 |
| Pith Efficiency | 3.0 | 2.8 | 5.0 | 5.0 | No change |
| Pith Actionability | 1.8 | 1.8 | 2.0 | 1.4 | **-0.6** |

**Notable Regression**: Pith dropped from 16.6/25 (v3) to 14.4/25 (v4). The difference is primarily due to **different task types**:
- v3 tasks were more implementation-focused (CLI orchestration, retry logic, JSDoc extraction)
- v4 tasks were more pattern/architecture-focused (design patterns, interface consumers, rate limiting implementation)

Pith performs better on tasks where module summaries provide useful orientation but struggles with:
- Pattern recognition across files
- Dependency/consumer tracing
- Detailed debugging guides
- Implementation planning for new features

---

## Information Gap Analysis

### Information Type Comparison

| Information Type | Pith | Control | Gap Severity |
|------------------|:----:|:-------:|:------------:|
| Module/file names | ✅ | ✅ | None |
| One-line summary | ✅ | ✅ | None |
| Purpose description | ✅ | ✅ | Minor |
| Gotchas/warnings | ⚠️ Generic | ✅ Specific | **High** |
| Key exports list | ✅ | ✅ | None |
| Import relationships | ✅ | ✅ | Minor |
| Fan-in/fan-out metrics | ✅ | ❌ | None (Pith advantage) |
| Git metadata | ✅ | ❌ | None (Pith advantage) |
| **Line numbers** | ⚠️ Listed | ✅ Contextual | **Medium** |
| **Code snippets** | ⚠️ Truncated | ✅ Full context | **Medium** |
| **Function signatures** | ✅ | ✅ | Minor |
| Specific variable/config values | ❌ | ✅ | **High** |
| **Design pattern identification** | ❌ | ✅ | **Critical** |
| **Consumer/usage mapping** | ❌ | ✅ | **Critical** |
| Implementation details | ❌ | ✅ | **Critical** |
| Error handling logic | ❌ | ✅ | **High** |
| Data flow explanation | ⚠️ Generic | ✅ Specific | **High** |
| Priority/criticality ranking | ❌ | ✅ | Medium |
| **Cross-file tracing** | ❌ | ✅ | **Critical** |
| Suggested changes | ❌ | ✅ | **High** |

### Concrete Example: Task 1 (Design Patterns)

| Detail | Pith Said | Control Said | Gap |
|--------|-----------|--------------|-----|
| Design patterns? | Not mentioned | 16 patterns identified with locations | **Critical gap** |
| Builder pattern? | "provides functions to build and store graph nodes" | "Builder pattern at builder/index.ts: buildFileNode (77-141), buildFunctionNode (172-212), buildModuleNode (247-278)" | **Pattern not named** |
| Pipeline pattern? | "Data enters via ast.ts... transforms... exits" | "Pipeline at cli:85-280: Extract→Build→Generate with specific functions" | **Too generic** |
| Singleton pattern? | "Manages database connections" | "Singleton at db:1-51: 'let db: MangoDb | null = null', getDb returns same instance" | **Missing pattern name and evidence** |

### Concrete Example: Task 5 (Rate Limiting)

| Detail | Pith Said | Control Said | Gap |
|--------|-----------|--------------|-----|
| Where to add? | "API module provides routes" | "Add after api:326 (after express.json()), update createApp signature at api:319" | **Missing implementation location** |
| What to change? | Not mentioned | "6 phases: package.json deps, config interface at config:27, api:319-326, cli:665-667" | **No implementation guidance** |
| CLI changes? | "CLI handles command-line arguments" | "Add --rate-limit, --rate-limit-max, --rate-limit-window options at lines 665-667" | **No specific instructions** |
| Code examples? | Not mentioned | Provided full code snippets for each change | **Missing entirely** |

---

## Key Observations

### Why v4 Scored Lower Than v3

1. **Task type mismatch**: v4 tasks required synthesis and pattern recognition, not just retrieval
2. **No pattern vocabulary**: Pith's prompts don't ask the LLM to identify design patterns
3. **No consumer tracing**: Pith can't follow "what uses X?" across files
4. **No implementation planning**: Pith describes what exists, not how to add new features

### Pith's Consistent Strengths

1. **Efficiency** (5.0/5) - Prose remains concise and focused
2. **Structural metadata** - Fan-in/out, git history, line counts are unique to Pith
3. **Fast retrieval** - Context returned instantly once wiki is built
4. **Orientation value** - Good for understanding module purposes

### Pith's Consistent Weaknesses

1. **No cross-file analysis** - Can't trace data flow or dependencies in detail
2. **No pattern recognition** - Doesn't synthesize higher-level patterns from code
3. **Generic gotchas** - "Error handling may need extending" vs specific conditions
4. **No implementation guidance** - Can't help plan modifications

### Why Control Wins

Control's advantage is the ability to:
1. **Synthesize across files** - Build complete dependency maps
2. **Recognize patterns** - Identify Builder, Factory, Strategy, etc.
3. **Provide debugging guides** - Specific file:line for each potential issue
4. **Plan implementations** - Step-by-step guides with insertion points

---

## Recommendations for Future Development

### Priority 1: Cross-File Relationship Synthesis
- Add inter-module relationship analysis
- Trace consumer usage patterns
- Build dependency graphs in prose

### Priority 2: Pattern Recognition
- Add prompts to identify common design patterns
- Name patterns explicitly in prose
- Provide pattern evidence from code

### Priority 3: Implementation Guidance
- Add "how to modify" sections for key files
- Include insertion point suggestions
- Provide template code for common changes

### Priority 4: Enhanced Debugging Context
- Add specific error scenarios to prose
- Include debugging flowcharts
- Provide step-by-step investigation guides

---

## Revision History

| Date | Change | Author |
|------|--------|--------|
| 2025-12-30 | Fourth benchmark run with new task types | Claude |
| 2025-12-30 | Added comparison showing task-type sensitivity | Claude |
